{% block body %}
    <style>
        .hiddencolumn {
            display: none;
        }        
    </style>
    <div class="d-flex justify-content-start align-items-start flex-wrap mt-2">
        <!-- Title + Guild -->
        <div class="flex-grow-1">
            <h4 class="font-weight-bold"><span class="display-4">#{{ modcase.caseId }}</span> {{ modcase.title }}
            </h4>

            <div class="d-flex align-items-lg-center">
                {% if guild|default %}
                <img
                        src="https://cdn.discordapp.com/icons/{{ guild.id }}/{{ guild.icon }}.png"
                        class="rounded-circle z-depth-0 mr-1"
                        alt="avatar image"
                        height="35"
                />
                <span class="font-weight-bold">Guild: {{ guild.name }}
                    {% endif %}
            <span class="text-black-50">({{ modcase.guildId }})</span></span>
            </div>
        </div>

        <!-- User icon -->
        {% if user|default %}
            <div class="align-self-end mr-4">
                <img
                        src="{{ user.imageUrl }}"
                        class="rounded-circle z-depth-0 mr-1"
                        alt="avatar image"
                        height="128"
                />
            </div>
        {% endif %}

        <!-- Edit and delete buttons -->
        <div class="d-flex flex-column">
            <a type="button" class="btn btn-primary"
                href="/api/v1/modcases/{{ modcase.guildId }}/{{ modcase.caseId }}" target="_blank">See raw case
                data</a>
            {% if modcase.guildId in basic_data.loggedInUser.modGuilds or basic_data.loggedInUser.isAdmin %}
                <a type="button" class="btn btn-warning" href="/modcases/{{ modcase.guildId }}/{{ modcase.caseId }}/edit">Edit this case</a>
                <a type="button" class="btn btn-danger" data-toggle="modal" data-target="#popupDeleteCase" href="#">Delete this case</a>
            {% endif %}
        </div>

    </div>
    <br/>
    <!-- Labels -->
    <div class="row mb-1 ml-2">
        <div class="d-flex justify-content-between">
            {% for label in modcase.labels|default([]) %}
                <a href="/modcases/{{ modcase.guildId }}?label={{ label }}">
                    <h3>
                        <span type="button" class="badge badge-pill badge-info mr-1">{{ label }}</span>
                    </h3>
                </a>
            {% endfor %}
        </div>
    </div>

    <!-- Table -->
    <div class="row">

        <!-- user info -->
        <div class="col-xl-6 col-lg-6 col-md-6 sm-col-12">
            <h4 class="font-weight-bold">User information</h4>

            <table class="table">
                <tbody>
                <tr>
                    <th class="font-weight-bold">Punishment</th>
                    <td>
                        <h3>
                            <span class="badge badge-danger">{{ modcase.punishment }}</span>
                        </h3>
                    </td>
                </tr>
                <tr>
                    <th class="font-weight-bold">UserID</th>
                    <td>
                        <a href="/modcases/{{ modcase.guildId }}?userId={{ modcase.userId }}">
                            {{ modcase.userId }}
                        </a>
                    </td>
                </tr>
                <tr>
                    <th class="font-weight-bold">Username</th>
                    <td class="font-weight-bold">
                        <a href="/modcases/{{ modcase.guildId }}?userId={{ modcase.userId }}">
                            {{ modcase.username }}
                        </a>
                    </td>
                </tr>
                <tr>
                    <th class="font-weight-bold">Nickname</th>
                    <td>
                        <a href="/modcases/{{ modcase.guildId }}?userId={{ modcase.userId }}">
                            {% if modcase.nickname != '' %}
                                {{ modcase.nickname }}
                            {% else %}
                                <span class="text-danger font-weight-bold">Not set.</span>
                            {% endif %}
                        </a>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- case info -->
        <div class="col-xl-6 col-lg-6 col-md-6 sm-col-12">
            <h4 class="font-weight-bold">Case information</h4>
            <table class="table">
                <tbody>
                <tr>
                    <th class="font-weight-bold">Severity</th>
                    <td>
                        {{ severities[modcase.severity]|default(modcase.severity) }}
                    </td>
                </tr>
                <tr>
                    <th class="font-weight-bold">Created at</th>
                    <td>{{ modcase.createdAt | date('d.m.Y H:i:s') }}</td>
                </tr>
                {% if modcase.occuredAt != modcase.createdAt %}
                    <tr>
                        <th class="font-weight-bold">Occured at</th>
                        <td>{{ modcase.occuredAt | date('d.m.Y H:i:s') }}</td>
                    </tr>
                {% endif %}
                {% if modcase.lastEditedAt != modcase.createdAt %}
                    <tr>
                        <th class="font-weight-bold">Last edited at</th>
                        <td>{{ modcase.lastEditedAt | date('d.m.Y H:i:s') }}</td>
                    </tr>
                {% endif %}
                <tr>
                    <th class="font-weight-bold">Moderator</th>
                    <td class="font-weight-bold">
                        <!-- mod info -->
                        <a href="/modcases/{{ modcase.guildId }}?modId={{ modcase.modId }}">
                            {% if moderator|default %}
                                <img
                                        src="{{ moderator.imageUrl }}"
                                        class="rounded-circle z-depth-0 mr-1"
                                        alt="avatar image"
                                        height="35"
                                /> {{ moderator.username }}
                            {% endif %}
                            <span class="text-black-50">({{ modcase.modId }})</span>
                        </a>
                    </td>
                </tr>
                {% if modcase.lastEditedByModId != modcase.modId %}
                    <tr>
                        <th class="font-weight-bold">Last Edit by Moderator</th>
                        <td class="font-weight-bold">
                            <!-- last mod info -->
                            <a href="/modcases/{{ modcase.guildId }}?modId={{ lastModerator.id }}">
                                {% if lastModerator|default %}
                                    <img
                                            src="{{ lastModerator.imageUrl }}"
                                            class="rounded-circle z-depth-0 mr-1"
                                            alt="avatar image"
                                            height="35"
                                    /> {{ lastModerator.username }}
                                {% endif %}
                            </a>
                        </td>
                    </tr>
                {% endif %}
                {% if modcase.punishmentType != 0 and modcase.punishmentType != 2 %}
                    <tr>
                        <th class="font-weight-bold">Punished until</th>
                        <td>
                            {% if modcase.punishedUntil is null %}
                                Forever
                            {% else %}
                                {{ modcase.punishedUntil | date('d.m.Y H:i:s') }}
                            {% endif %}
                        </td>
                    </tr>
                {% endif %}
                {% if not modcase.punishmentActive and modcase.punishmentType != 0 and modcase.punishmentType != 2 %}
                    <tr>
                        <th class="font-weight-bold">Punishment</th>
                        <td>Punishment inactive</td>
                    </tr>
                {% endif %}
                </tbody>
            </table>
        </div>
        <br>
    </div>

    <!-- Description -->
    <div class="mb-3">
        <h4 class="font-weight-bold">Full case description</h4>
        <hr/>
        <span style="white-space: pre-wrap;" class="text-monospace">{{ modcase.description }}</span>
    </div>

{% endblock body %}

{% block scriptblock %}
    <script>
        function deleteCase(obj) {
            let sendNotification = $('#deleteCaseSendNotification').is(":checked").toString();
            $.ajax({
                type: "DELETE",
                url: "/api/v1/modcases/{{ modcase.guildId|default }}/{{ modcase.caseId|default }}?sendNotification=" + sendNotification,
                success: function (data) {
                    location.href = '/modcases/{{ modcase.guildId|default }}';
                },
                error: function (errMsg) {
                    handleRequestError(errMsg, "Deleting case failed");
                }
            });
        }
    </script>
{% endblock %}
